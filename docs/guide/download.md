# 下载与处理

## 任务管理

应用的任务管理基于队列与任务组机制，层级关系如下：

```txt
队列
└── 任务组
    └── 任务
        └── 子任务
```

并发以任务为单位，可跨任务组并发。子任务考虑连续性，因此选择串行执行。

任务组的本质为“调度器（Scheduler）”，负责组织并调度其中的任务。

## 执行流程

等待队列中，始终存在一个特殊的任务组：**备选区**。其中的任务仅作缓冲处理，不会立即开始下载，只有在手动点击 **<i class="fa-solid fa-download"></i> 开始执行** 按钮后才会开始下载。

你也可以在 [设置 -> 通用 -> 自动开始下载](/guide/settings#自动开始下载) 中配置自动开始下载。

1. 在参数选择界面选择好对应资源与参数，点击 **<i class="fa-solid fa-arrow-right"></i> 下一步** 按钮后，任务就会被推送至此处的备选区。
2. 点击备选区上方高亮的 **<i class="fa-solid fa-download"></i> 开始执行** 按钮后，备选区内的所有任务会被立即规划为一个新的任务组，并推入进行队列。
3. 任务组中的每个任务将按照 [设置 -> 下载 -> 最大并发下载数](/guide/settings#最大并发下载数) 中配置的数量并发处理。
4. 处理完成后，无论任务是否处理成功，都将被推入完成队列。

## 卡片信息

任务组及任务信息会使用卡片形式展示。

### 任务组卡片

从左至右分别展示：

- **<i class="fa-solid fa-id-badge"></i> 任务组唯一ID**
- 任务组被规划的时间
- 暂停 & 恢复、打开文件夹与删除按钮

暂停/恢复按钮仅在任务进行时可用。

### 任务卡片

从上至下分别展示：

- 标题 / 任务创建时间
- 子任务信息 / **<i class="fa-solid fa-id-badge"></i> 任务唯一ID** / **<i class="fa-solid fa-hashtag"></i> 在任务组中的序号**
- **<i class="fa-solid fa-list"></i> 详细信息** 按钮 / 总流程进度条 / 暂停 & 恢复、打开文件夹与删除按钮。

> [!TIP]
> 在任务仍在备选区时，可以通过点击子任务信息区域的对应信息来重新选择参数。例如上文中提到的“修改分辨率”便可在此处修改。

点击 **<i class="fa-solid fa-list"></i> 详细信息** 按钮后会展示：

- 各子任务进度
- 基本信息（资源分类、AID、BVID、上传时间等）

暂停/恢复按钮仅在任务进行时可用。

任务状态会通过描边颜色提示：

- <code style="color: #a2a7ae">灰色</code>: 等待中（pending）
- <code style="color: #00a1d6">蓝色</code>: 进行中（active）
- <code style="color: #4caf50">绿色</code>: 成功完成（completed）
- <code style="color: #ffc107">黄色</code>: 暂停（paused）
- <code style="color: #ff5252">红色</code>: 失败（failed）

## 任务管理

通过点击任务卡片上的按钮，可以对任务进行如下操作：

- 暂停 & 恢复
  - 对于 **视频/音频** 子任务，支持断点续传，暂停时会立即中止下载，恢复后继续下载。
  - 对于其他子任务（如字幕、NFO、弹幕），暂停时不会立即中止该任务进行，而是让当前子任务继续完成，再进入暂停窗台。恢复后会继续进行下一个子任务。
- 删除任务
  - 立即取消任务，同时从数据库中删除记录。
  - 已下载至本地的文件将不受影响。
